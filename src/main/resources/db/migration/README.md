db.migration Directory
============================

This is pretty much normal directory containing migration scripts, that will be read by `flyway`
to initialize database objects. 

Note that not all existing database objects are created by `flyway`. Most of them were created
manually, before `flyway` was taken into use. As a reminder to that fact, the lowest migration script
version in this directory is V20. Now that `flyway` is used to create objects, all new database
objects should be created using `flyway`, by adding migration scripts to this directory. 

In addition to normal sql migration scripts written manually, there is a script 
`R__recreate_archive_tables_and_functions.sql` which is generated. See the next chapter for the 
instructions how to (re)generate that script, if needed. 

Archive tables and functions
----------------------------

Archive tables and functions are generated by running `generate-archive-functions.sh` 
script, which will read `tables.data` to get the list of tables and their columns. 
The template of the SQL function to archive the tables is built into the 
`generate-archive-functions.sh` script, and should be edited there, if changes
are needed. After changes are done, generate the sql script again and run at least the
`DbArchiveSpec` test.  

In `tables.data`, for each table for which we want to generate archive function 
there should be one line in format:

    tablename: column1, column2, ... 